"use strict";(self.webpackChunkmy_framework_docs=self.webpackChunkmy_framework_docs||[]).push([[5075],{6401:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"Part 5 - Reinforcement Learning/Foundations of Reinforcement Learning/Chapter 1 - Introduction to RL Concepts/1.3 - Our Solution - The Gym Environment Wrapper","title":"1.3 - Our Solution - The Gym Environment Wrapper","description":"To resolve the async vs. sync conflict, we will architect a solution using a well-established software design pattern: an Adapter. We will create a custom Python class that acts as a bridge, presenting a standard, synchronous gymnasium interface to the RL agent, while internally managing the complex, asynchronous python-sc2 game process.","source":"@site/docs/Part 5 - Reinforcement Learning/1 - Foundations of Reinforcement Learning/Chapter 1 - Introduction to RL Concepts/1.3 - Our Solution - The Gym Environment Wrapper.md","sourceDirName":"Part 5 - Reinforcement Learning/1 - Foundations of Reinforcement Learning/Chapter 1 - Introduction to RL Concepts","slug":"/Part 5 - Reinforcement Learning/Foundations of Reinforcement Learning/Chapter 1 - Introduction to RL Concepts/1.3 - Our Solution - The Gym Environment Wrapper","permalink":"/learn-python-sc2/docs/Part 5 - Reinforcement Learning/Foundations of Reinforcement Learning/Chapter 1 - Introduction to RL Concepts/1.3 - Our Solution - The Gym Environment Wrapper","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"1.2 - The Core Challenge - async vs sync","permalink":"/learn-python-sc2/docs/Part 5 - Reinforcement Learning/Foundations of Reinforcement Learning/Chapter 1 - Introduction to RL Concepts/1.2 - The Core Challenge - async vs sync"},"next":{"title":"2.1 - Installing RL Libraries","permalink":"/learn-python-sc2/docs/Part 5 - Reinforcement Learning/Foundations of Reinforcement Learning/Chapter 2 - Setting Up the RL Environment/2.1 - Installing RL Libraries"}}');var r=t(4848),i=t(8453);const o={},c=void 0,a={},l=[{value:"<strong>The <code>gymnasium.Env</code> API Contract</strong>",id:"the-gymnasiumenv-api-contract",level:4},{value:"<strong>The Implementation Plan</strong>",id:"the-implementation-plan",level:4},{value:"<strong>System Architecture Diagram</strong>",id:"system-architecture-diagram",level:4}];function d(e){const n={code:"code",h4:"h4",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["To resolve the ",(0,r.jsx)(n.code,{children:"async"})," vs. ",(0,r.jsx)(n.code,{children:"sync"})," conflict, we will architect a solution using a well-established software design pattern: an ",(0,r.jsx)(n.strong,{children:"Adapter"}),". We will create a custom Python class that acts as a bridge, presenting a standard, synchronous ",(0,r.jsx)(n.code,{children:"gymnasium"})," interface to the RL agent, while internally managing the complex, asynchronous ",(0,r.jsx)(n.code,{children:"python-sc2"})," game process."]}),"\n",(0,r.jsx)(n.p,{children:"This wrapper is the cornerstone of our entire RL implementation."}),"\n",(0,r.jsx)(n.h4,{id:"the-gymnasiumenv-api-contract",children:(0,r.jsxs)(n.strong,{children:["The ",(0,r.jsx)(n.code,{children:"gymnasium.Env"})," API Contract"]})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"stable-baselines3"})," requires its environments to adhere to the ",(0,r.jsx)(n.code,{children:"gymnasium.Env"})," API. Our wrapper must implement this contract precisely."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Method Signature"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Role in Our Wrapper"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"__init__(self, ...)"})}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:["Defines the ",(0,r.jsx)(n.code,{children:"action_space"})," and ",(0,r.jsx)(n.code,{children:"observation_space"}),". Creates the communication queues."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"reset(self)"})}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,r.jsx)(n.strong,{children:"Episode Start."})," Terminates any old game process, launches a new one, waits for the initial observation, and returns it."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"step(self, action)"})}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,r.jsx)(n.strong,{children:"Core Interaction."})," Takes an ",(0,r.jsx)(n.code,{children:"action"})," from the agent, puts it on the action queue, waits for the game to process it, retrieves the result from the observation queue, and returns it."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"close(self)"})}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,r.jsx)(n.strong,{children:"Cleanup."})," Ensures the ",(0,r.jsx)(n.code,{children:"python-sc2"})," game process is properly terminated when training finishes."]})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"the-implementation-plan",children:(0,r.jsx)(n.strong,{children:"The Implementation Plan"})}),"\n",(0,r.jsxs)(n.p,{children:["Our ",(0,r.jsx)(n.code,{children:"SC2GymEnv"})," wrapper will be responsible for orchestrating the two processes. Our ",(0,r.jsx)(n.code,{children:"BotAI"})," subclass will also need to be modified to listen for commands."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"SC2GymEnv"})," (The Wrapper - Process 1):"]})}),"\n",(0,r.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Inherit from ",(0,r.jsx)(n.code,{children:"gymnasium.Env"}),"."]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Initialize ",(0,r.jsx)(n.code,{children:"multiprocessing.Queue"})," for actions and observations."]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Implement ",(0,r.jsx)(n.code,{children:"reset"})," to manage the game process lifecycle."]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Implement ",(0,r.jsx)(n.code,{children:"step"})," to pass data between queues."]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Implement ",(0,r.jsx)(n.code,{children:"close"})," for clean shutdown."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"RLBotAI"})," (The Game Actor - Process 2):"]})}),"\n",(0,r.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Be initialized with the communication queues."]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","In ",(0,r.jsx)(n.code,{children:"on_step"}),", get an ",(0,r.jsx)(n.code,{children:"action"})," from the action queue (blocking)."]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Execute the action in the game world."]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Calculate the ",(0,r.jsx)(n.code,{children:"observation"})," and ",(0,r.jsx)(n.code,{children:"reward"}),"."]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Put the ",(0,r.jsx)(n.code,{children:"(obs, reward, terminated, ...)"})," tuple on the observation queue."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"system-architecture-diagram",children:(0,r.jsx)(n.strong,{children:"System Architecture Diagram"})}),"\n",(0,r.jsxs)(n.p,{children:["This diagram illustrates the complete, two-process architecture with our ",(0,r.jsx)(n.code,{children:"SC2GymEnv"})," wrapper as the bridge."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"            +--------------------------+      +---------------------------+      +---------------------------+\r\n            |   stable-baselines3      |      |     SC2GymEnv Wrapper     |      |    python-sc2 Game Proc.  |\r\n            |     (Training Loop)      |      |      (Our Adapter)        |      |      (Our RLBotAI)        |\r\n            +--------------------------+      +---------------------------+      +---------------------------+\r\n           |                               |                                  |\r\n           | calls env.step(action)        |                                  |\r\n           |------------------------------\x3e| action_q.put(action)             |\r\n           |                               |---------------------------------\x3e| action = action_q.get()\r\n           |                               |                                  |\r\n           |                               |                                  | ...plays game step...\r\n           |                               |                                  |\r\n           |                               |                                  | new_obs, ... = ...\r\n           |                               |                                  | obs_q.put(new_obs, ...)\r\n           |                               | obs, ... = obs_q.get() <---------|------------------------\r\n           |                               |                                  |\r\n           | returns (obs, reward, ...)    |                                  |\r\n           |<------------------------------|                                  |\r\n           |                               |                                  |\r\n\r\n                Synchronous Process 1            Inter-Process Queues               Asynchronous Process 2\n"})}),"\n",(0,r.jsxs)(n.p,{children:["With this design, the RL agent operates within its standard synchronous loop, completely abstracted from the asynchronous nature of the game it is learning to control. In the next chapter, we will implement this ",(0,r.jsx)(n.code,{children:"SC2GymEnv"})," class."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var s=t(6540);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);