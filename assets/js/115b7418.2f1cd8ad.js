"use strict";(self.webpackChunkmy_framework_docs=self.webpackChunkmy_framework_docs||[]).push([[978],{6119:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"Part 5 - Reinforcement Learning/Advanced RL and Next Steps/Chapter 9 - Improving Your Agent with Action Masking/9.1 - The Problem - Wasted, Impossible Actions","title":"9.1 - The Problem - Wasted, Impossible Actions","description":"The shift to a generalized, decomposed action space in our DRLRMBot architecture, while powerful, introduces a well-known and critical challenge in applied reinforcement learning: the Invalid Action Problem. The agent\'s theoretical action space becomes vastly larger than its effective action space at any given moment, which severely impedes the learning process.","source":"@site/docs/Part 5 - Reinforcement Learning/2 - Advanced RL and Next Steps/03-Chapter 9 - Improving Your Agent with Action Masking/9.1 - The Problem - Wasted, Impossible Actions.md","sourceDirName":"Part 5 - Reinforcement Learning/2 - Advanced RL and Next Steps/03-Chapter 9 - Improving Your Agent with Action Masking","slug":"/Part 5 - Reinforcement Learning/Advanced RL and Next Steps/Chapter 9 - Improving Your Agent with Action Masking/9.1 - The Problem - Wasted, Impossible Actions","permalink":"/learn-python-sc2/docs/Part 5 - Reinforcement Learning/Advanced RL and Next Steps/Chapter 9 - Improving Your Agent with Action Masking/9.1 - The Problem - Wasted, Impossible Actions","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"8.3 - The Challenge of a Large Action Space","permalink":"/learn-python-sc2/docs/Part 5 - Reinforcement Learning/Advanced RL and Next Steps/Chapter 8 - Advanced Implementation - DRL-RM/8.3 - The Challenge of a Large Action Space"},"next":{"title":"9.2 - How Action Masking Works","permalink":"/learn-python-sc2/docs/Part 5 - Reinforcement Learning/Advanced RL and Next Steps/Chapter 9 - Improving Your Agent with Action Masking/9.2 - How Action Masking Works"}}');var r=t(4848),a=t(8453);const s={},o=void 0,c={},l=[{value:"<strong>Analysis- Search Space Disparity</strong>",id:"analysis--search-space-disparity",level:4},{value:"<strong>Categorization of Invalid Actions</strong>",id:"categorization-of-invalid-actions",level:4},{value:"<strong>Impact on the Learning Process</strong>",id:"impact-on-the-learning-process",level:4}];function d(e){const n={code:"code",em:"em",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["The shift to a generalized, decomposed action space in our ",(0,r.jsx)(n.code,{children:"DRL_RM_Bot"})," architecture, while powerful, introduces a well-known and critical challenge in applied reinforcement learning: the ",(0,r.jsx)(n.strong,{children:"Invalid Action Problem"}),". The agent's theoretical action space becomes vastly larger than its ",(0,r.jsx)(n.em,{children:"effective"})," action space at any given moment, which severely impedes the learning process."]}),"\n",(0,r.jsx)(n.h4,{id:"analysis--search-space-disparity",children:(0,r.jsx)(n.strong,{children:"Analysis- Search Space Disparity"})}),"\n",(0,r.jsxs)(n.p,{children:["At any point in a game, the number of ",(0,r.jsx)(n.em,{children:"valid"})," actions is a tiny subset of the ",(0,r.jsx)(n.em,{children:"total possible"})," actions the agent can choose from."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Diagram of the Action Space:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"+--------------------------------------------------------------------------+\r\n|                                                                          |\r\n|   Total Theoretical Action Space (10,000+ combinations)                  |\r\n|                                                                          |\r\n|                                                                          |\r\n|       The RL agent's random exploration is searching this entire area.   |\r\n|                                                                          |\r\n|                                                                          |\r\n|                               +-----------------+                        |\r\n|                               | Effective (Valid)|                       |\r\n|                               | Action Space    |                        |\r\n|                               | (e.g., ~10-100  |                        |\r\n|                               |  combinations)  |                        |\r\n|                               +-----------------+                        |\r\n|                                                                          |\r\n+--------------------------------------------------------------------------+\n"})}),"\n",(0,r.jsx)(n.p,{children:"The agent is, in effect, searching a 100m-by-100m field for a coin."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h4,{id:"categorization-of-invalid-actions",children:(0,r.jsx)(n.strong,{children:"Categorization of Invalid Actions"})}),"\n",(0,r.jsxs)(n.p,{children:["Invalid actions in our ",(0,r.jsx)(n.code,{children:"DRL_RM_Bot"})," can be broken down into two primary types:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Category"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Definition"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"Out-of-Bounds (OOB) Invalidity"})}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:["The action is invalid because a chosen index (",(0,r.jsx)(n.code,{children:"actor_id"})," or ",(0,r.jsx)(n.code,{children:"target_id"}),") does not correspond to an existing unit in the current game state."]}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:["The bot controls 5 Marines (valid ",(0,r.jsx)(n.code,{children:"actor_id"})," values are ",(0,r.jsx)(n.code,{children:"0-4"}),"). The agent chooses ",(0,r.jsx)(n.code,{children:"actor_id = 25"}),". This action is syntactically valid but semantically impossible."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"State-Based Invalidity"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"The action is syntactically valid (all indices are in-bounds), but the action is illegal according to the game's rules engine."}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:["The agent chooses ",(0,r.jsx)(n.code,{children:"actor_id = 3"})," (a Marine) and ",(0,r.jsx)(n.code,{children:"target_id = 1"})," (another friendly Marine). The game engine forbids attacking friendly units, so this command would fail."]})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h4,{id:"impact-on-the-learning-process",children:(0,r.jsx)(n.strong,{children:"Impact on the Learning Process"})}),"\n",(0,r.jsx)(n.p,{children:"Allowing the agent to freely explore this vast space of invalid actions has severe, negative consequences for training."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Extreme Sample Inefficiency:"}),'\r\nReinforcement learning requires "sampling" the environment by trying actions. When over 99% of the actions an agent tries are invalid, the process of discovering a rare, valid action that leads to a positive reward becomes extraordinarily slow. The training budget is wasted on exploring meaningless choices.']}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Gradient Signal Degradation:"}),'\r\nThe agent learns by updating its neural network based on the "gradient" of the reward signal. If the reward signal is almost always zero or a small penalty (for trying an invalid action), the gradient becomes sparse and noisy. The meaningful gradients from rare, successful actions are drowned out, making it difficult for the model to converge on an effective policy.']}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Conclusion:"}),"\r\nFor the learning problem to be tractable, we cannot permit the agent to explore the full theoretical action space. We must inject domain knowledge into the system to constrain its choices to only those that are valid at the current step. The standard architectural pattern for this is ",(0,r.jsx)(n.strong,{children:"Action Masking"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(6540);const r={},a=i.createContext(r);function s(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);